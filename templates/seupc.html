<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montagem - KitPc</title>
    <link rel="icon" href="{{ url_for('static', filename='Imagens/favicon.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3396569889908907"
        crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/seuPc.css') }}">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <div class="d-flex align-items-center">
                    <img src="{{ url_for('static', filename='Imagens/Logo KitPc.png') }}" alt="logo-kitpc"
                        class="logo-kitpc">
                    <h1 class="h4 mb-0 ms-2 text-light" style="font-family: 'Orbitron', sans-serif;">Montagem</h1>
                </div>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('home') }}">In√≠cio</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('montagem') }}">Montagem</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('arquivo') }}">Blog</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('educacao') }}">Educa√ß√£o</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('sobre_nos') }}">Sobre N√≥s</a></li>

                        {% if session['nome'] %}
                        <li class="nav-item d-flex align-items-center gap-2 ms-lg-3 mt-3 mt-lg-0">
                            <span class="text-info fw-bold" style="white-space: nowrap;">
                                <i class="fas fa-user-circle"></i> {{ session['nome'].split(' ')[0] }}
                            </span>
                            <div class="d-flex gap-2">
                                {% if session['is_admin'] %}
                                <a class="btn btn-outline-warning btn-sm" href="{{ url_for('admin') }}">ADM</a>
                                {% endif %}
                                <a class="fa-solid fa-arrow-right-from-bracket" style="color: #ff4d4d;"
                                    href="{{ url_for('logout') }}"></a>
                            </div>
                        </li>
                        {% else %}
                        <li class="nav-item ms-lg-3 mt-3 mt-lg-0">
                            <button class="btn btn-outline-info btn-sm fw-bold" data-bs-toggle="modal"
                                data-bs-target="#modalAcesso">
                                <i class="fa-solid fa-arrow-right-to-bracket"></i> Entrar
                            </button>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="modal fade" id="modalAcesso" tabindex="-1" aria-labelledby="modalAcessoLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark border-info">
                <div class="modal-header border-bottom border-info">
                    <ul class="nav nav-tabs card-header-tabs w-100" id="authTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active fw-bold" id="login-tab" data-bs-toggle="tab"
                                data-bs-target="#login" type="button" role="tab" style="color: #3CC9E4;">LOGIN</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-bold" id="register-tab" data-bs-toggle="tab"
                                data-bs-target="#register" type="button" role="tab"
                                style="color: #9216FD;">CADASTRAR</button>
                        </li>
                    </ul>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="tab-content" id="authTabsContent">
                        <div class="tab-pane fade show active" id="login" role="tabpanel">
                            <form action="{{ url_for('login') }}" method="POST">
                                <div class="mb-3">
                                    <label class="form-label text-info">Email</label>
                                    <input type="email" name="email"
                                        class="form-control bg-transparent text-white border-info" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-info">Senha</label>
                                    <input type="password" name="senha"
                                        class="form-control bg-transparent text-white border-info" required>
                                </div>
                                <button type="submit" class="btn btn-info w-100 fw-bold mt-2">ACESSAR CONTA</button>
                            </form>
                            <a href="{{ url_for('login_google') }}" class="btn-google-custom">
                                <div class="google-icon-wrapper">
                                    <img src="{{ url_for('static', filename='Imagens/Logo-google-icon-PNG.png') }}"
                                        alt="Google">
                                </div>
                                <span class="google-text">Continuar com Google</span>
                            </a>
                        </div>
                        <div class="tab-pane fade" id="register" role="tabpanel">
                            <form action="{{ url_for('register') }}" method="POST">
                                <div class="mb-3">
                                    <label class="form-label" style="color: #9216FD;">Nome Completo</label>
                                    <input type="text" name="nome" class="form-control bg-transparent text-white"
                                        style="border: 1px solid #9216FD;" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" style="color: #9216FD;">Email</label>
                                    <input type="email" name="email" class="form-control bg-transparent text-white"
                                        style="border: 1px solid #9216FD;" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label" style="color: #9216FD;">Senha</label>
                                    <input type="password" name="senha" class="form-control bg-transparent text-white"
                                        style="border: 1px solid #9216FD;" required>
                                </div>
                                <button type="submit" class="btn w-100 fw-bold mt-2"
                                    style="background-color: #9216FD; color: white;">CRIAR CONTA</button>
                            </form>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="container mt-5">
        <div class="question p-4 mb-4 border rounded shadow-sm" onclick="toggleQuestion(this)">
            <h2 class="text-center mb-3"><i class="fa-solid fa-money-bill-1-wave"></i> Seu or√ßamento?</h2>
            <div class="d-flex justify-content-center flex-wrap gap-3">
                <button class="btn btn-outline-info fw-bold" onclick="setAnswer('preco', 'Um PC OK', event)">
                    PC OK<br><small>At√© R$ 2.000,00</small>
                </button>
                <button class="btn btn-outline-info fw-bold" onclick="setAnswer('preco', 'Um PC BOM', event)">
                    PC BOM<br><small>At√© R$ 3.000,00</small>
                </button>
                <button class="btn btn-outline-info fw-bold" onclick="setAnswer('preco', 'Um PC MUITO BOM', event)">
                    PC MUITO BOM<br><small>At√© R$ 5.000,00</small>
                </button>
                <button class="btn btn-outline-info fw-bold" onclick="setAnswer('preco', 'At√© a NASA quer', event)">
                    At√© a NASA quer<br><small>üò±üò±üò±</small>
                </button>
            </div>
            <div class="text-center mt-3">
                <strong>Resposta:</strong> <span id="preco" class="text-info">Nenhuma</span>
            </div>
        </div>

        <div class="question p-4 mb-4 border rounded shadow-sm" onclick="toggleQuestion(this)">
            <h2 class="text-center"><i class="fa-solid fa-gear"></i> Montagem ou Reforma?</h2>
            <div class="answers d-flex justify-content-center flex-wrap gap-2 mt-3">
                <button class="btn btn-outline-info" onclick="setAnswer('tipo','Montar do Zero',event)">Montar do
                    zero</button>
                <button class="btn btn-outline-info" onclick="setAnswer('tipo','Reformar', event)">Reformar</button>
            </div>
            <div class="text-center mt-3">
                <strong>Resposta:</strong> <span id="tipo" class="text-info">Nenhuma</span>
            </div>
        </div>

        <div class="question p-4 mb-4 border rounded shadow-sm" onclick="toggleQuestion(this)">
            <h2 class="text-center"><i class="fa-solid fa-desktop"></i> Para qual uso?</h2>
            <div class="answers d-flex justify-content-center flex-wrap gap-2 mt-3">
                <button class="btn btn-outline-info" onclick="setAnswer('uso', 'Jogo', event)" data-bs-toggle="tooltip"
                    title="Ideal para alta performance e gr√°ficos">Jogo</button>
                <button class="btn btn-outline-info" onclick="setAnswer('uso', 'Trabalho', event)"
                    data-bs-toggle="tooltip" title="Edi√ß√£o, design ou multitarefa">Trabalho</button>
                <button class="btn btn-outline-info" onclick="setAnswer('uso', 'Estudos', event)"
                    data-bs-toggle="tooltip" title="Pesquisas e videoaulas">Estudos</button>
                <button class="btn btn-outline-info" onclick="setAnswer('uso', 'Uso geral', event)"
                    data-bs-toggle="tooltip" title="Tarefas b√°sicas do dia a dia">Uso geral</button>
            </div>
            <div class="text-center mt-3">
                <strong>Resposta:</strong> <span id="uso" class="text-info">Nenhuma</span>
            </div>
        </div>

        <div class="question p-4 mb-4 border rounded shadow-sm" onclick="toggleQuestion(this)">
            <h2 class="text-center"><i class="fa-solid fa-gamepad"></i> Quer placa de v√≠deo?</h2>
            <div class="answers d-flex justify-content-center flex-wrap gap-2 mt-3">
                <button class="btn btn-outline-info" onclick="setAnswer('gpu', 'Sim', event)">Sim</button>
                <button class="btn btn-outline-info" onclick="setAnswer('gpu', 'N√£o', event)">N√£o valeu</button>
            </div>
            <div class="text-center mt-3">
                <strong>Resposta:</strong> <span id="gpu" class="text-info">Nenhuma</span>
            </div>
        </div>

        <div class="question p-4 mb-4 border rounded shadow-sm" onclick="toggleQuestion(this)">
            <h2 class="text-center"><i class="fa-solid fa-microchip"></i> Qual processador?</h2>
            <div class="answers d-flex justify-content-center flex-wrap gap-2 mt-3">
                <button class="btn btn-outline-info" onclick="setAnswer('processador', 'AMD', event)">AMD</button>
                <button class="btn btn-outline-info" onclick="setAnswer('processador', 'Intel', event)">Intel</button>
            </div>
            <div class="text-center mt-3">
                <strong>Resposta:</strong> <span id="processador" class="text-info">Nenhuma</span>
            </div>
        </div>

        <div class="question p-4 mb-4 border rounded shadow-sm" onclick="toggleQuestion(this)">
            <h2 class="text-center"><i class="fa-solid fa-laptop"></i> Notebook te ajuda?</h2>
            <div class="answers d-flex justify-content-center flex-wrap gap-2 mt-3">
                <button class="btn btn-outline-info" onclick="setAnswer('laptop', 'Sim', event)">Sim,
                    mobilidade!</button>
                <button class="btn btn-outline-info" onclick="setAnswer('laptop', 'N√£o', event)">N√£o, prefiro
                    fixo</button>
            </div>
            <div class="text-center mt-3">
                <strong>Resposta:</strong> <span id="laptop" class="text-info">Nenhuma</span>
            </div>
        </div>

        <div class="text-center my-5">
            <button class="btn btn-info btn-lg fw-bold text-dark shadow" onclick="finalizar()">üîß Montar meu computador
                ‚öôÔ∏è</button>
        </div>

        <div id="resultado" class="mt-5">
            <div id="loading" class="text-center d-none mb-5">
                <div class="spinner-border text-info" style="width: 3rem; height: 3rem;" role="status"></div>
                <p class="text-info mt-3 fw-bold">A IA est√° escolhendo as melhores pe√ßas no banco de dados...</p>
            </div>

            <div id="lista-pe√ßas" class="row g-4"></div>

            <div id="justificativa-container" class="mt-4 p-4 border border-info rounded bg-dark d-none">
                <h4 class="text-info"><i class="fa-solid fa-robot"></i> Dica do Especialista KitPC:</h4>
                <p id="texto-justificativa" class="text-white mb-0"></p>
            </div>
        </div>
    </main>
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
    <footer>
        <div class="footer-content">
            <p>&copy; 2026 KitPC - Todos os direitos reservados</p>
            <div class="footer-links">
                <a href="{{ url_for('privacidade') }}"
                    class="link-light link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Privacidade</a>
                |
                <a href="{{ url_for('termos') }}"
                    class="link-light link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">Termos
                    de Uso</a>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>

    <script>
        // Fun√ß√£o para marcar a resposta e mudar a cor do bot√£o selecionado
        function setAnswer(categoria, valor, event) {
            // Impede que o clique no bot√£o feche o card (toggleQuestion)
            event.stopPropagation();

            // Atualiza o texto da resposta no <span>
            document.getElementById(categoria).innerText = valor;

            // Remove a classe 'btn-info' (azul preenchido) de todos os bot√µes daquele grupo
            const parent = event.target.closest('.answers') || event.target.closest('.d-flex');
            const botoes = parent.querySelectorAll('.btn');
            botoes.forEach(btn => {
                btn.classList.remove('btn-info', 'text-dark');
                btn.classList.add('btn-outline-info');
            });

            // Adiciona a cor de selecionado ao bot√£o clicado
            event.target.classList.remove('btn-outline-info');
            event.target.classList.add('btn-info', 'text-dark');
        }

        // Fun√ß√£o para abrir/fechar as perguntas (sanfona)
        function toggleQuestion(element) {
            // Voc√™ pode usar isso para esconder as respostas e mostrar s√≥ quando clicar
            // Se preferir deixar tudo aberto, pode deixar a fun√ß√£o vazia
        }
        async function finalizar() {
            // 1. Pega as respostas que est√£o nos <span> do seu HTML
            const dados = {
                preco: document.getElementById('preco').innerText,
                tipo: document.getElementById('tipo').innerText,
                uso: document.getElementById('uso').innerText,
                gpu: document.getElementById('gpu').innerText,
                processador: document.getElementById('processador').innerText,
                laptop: document.getElementById('laptop').innerText
            };

            // Valida√ß√£o simples
            if (dados.preco === "Nenhuma") {
                alert("Por favor, selecione ao menos o or√ßamento!");
                return;
            }

            // 2. Prepara a tela (mostra loading e esconde resultados antigos)
            const loading = document.getElementById('loading');
            const listaPecas = document.getElementById('lista-pe√ßas');
            const justificativaDiv = document.getElementById('justificativa-container');

            loading.classList.remove('d-none');
            listaPecas.innerHTML = '';
            justificativaDiv.classList.add('d-none');

            try {
                // 3. Chama a sua rota do Flask
                const response = await fetch('/consultoria-ia', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });

                const data = await response.json();

                if (data.erro) {
                    alert("Erro: " + data.erro);
                } else {
                    // 4. Monta os cards dinamicamente
                    data.setup.forEach(peca => {
                        const card = `
                    <div class="col-md-4">
                        <div class="card h-100 bg-dark border-secondary shadow-sm card-hover">
                            <img src="${peca.imagem_url}" class="card-img-top p-3" alt="${peca.nome}" 
                                 onerror="this.src='/static/Imagens/processador.png'">
                            <div class="card-body d-flex flex-column">
                                <h6 class="text-info uppercase small fw-bold">${peca.componente}</h6>
                                <h5 class="card-title text-white h6">${peca.nome}</h5>
                                <p class="card-text text-secondary small flex-grow-1">${peca.justificativa}</p>
                                <hr class="border-secondary">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="text-success fw-bold">${peca.preco_estimado || ''}</span>
                                    <a href="${peca.link_loja || '#'}" target="_blank" class="btn btn-sm btn-outline-info">Ver Loja</a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                        listaPecas.innerHTML += card;
                    });

                    // 5. Mostra o conselho da IA
                    document.getElementById('texto-justificativa').innerText = data.conselho_mestre || data.justificativa_geral;
                    justificativaDiv.classList.remove('d-none');
                }
            } catch (error) {
                console.error("Erro ao montar PC:", error);
                alert("Ocorreu um erro ao conectar com a IA.");
            } finally {
                loading.classList.add('d-none');
                // Rola a tela para o resultado
                document.getElementById('resultado').scrollIntoView({ behavior: 'smooth' });
            }
        }
    </script>
</body>

</html>